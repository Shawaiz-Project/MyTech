{% extends "admin/base.html" %}

{% block page_title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <h1>Analytics Dashboard</h1>
        <p style="color: #b0c4de; margin-top: 0.5rem;">Welcome back! Here's your website performance overview</p>
    </div>

    <!-- Stat Cards Grid -->
    <div class="stats-grid-modern">
        <div class="stat-card-modern stat-purple">
            <div class="stat-card-header">
                <h3>Total Pages</h3>
                <i class="fas fa-file"></i>
            </div>
            <p class="stat-number">{{ total_projects + total_services + total_blogs }}</p>
            <p class="stat-label">Content items</p>
        </div>

        <div class="stat-card-modern stat-pink">
            <div class="stat-card-header">
                <h3>Total Views</h3>
                <i class="fas fa-eye"></i>
            </div>
            <p class="stat-number">{{ total_page_views }}</p>
            <p class="stat-label">All time</p>
        </div>

        <div class="stat-card-modern stat-cyan">
            <div class="stat-card-header">
                <h3>New Messages</h3>
                <i class="fas fa-envelope"></i>
            </div>
            <p class="stat-number">{{ unread_messages }}</p>
            <p class="stat-label">Unread</p>
        </div>

        <div class="stat-card-modern stat-green">
            <div class="stat-card-header">
                <h3>Team Members</h3>
                <i class="fas fa-users"></i>
            </div>
            <p class="stat-number">{{ total_team }}</p>
            <p class="stat-label">Active</p>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- Project Growth Over Time -->
        <div class="chart-card">
            <div class="chart-header">
                <h3><i class="fas fa-chart-line"></i> Project Growth Over Time</h3>
                <span class="chart-period">Real-time data</span>
            </div>
            <canvas id="projectGrowthChart"></canvas>
        </div>

        <!-- Page Analytics -->
        <div class="chart-card">
            <div class="chart-header">
                <h3><i class="fas fa-bar-chart"></i> Page Visits</h3>
                <span class="chart-period">Top pages</span>
            </div>
            <canvas id="pageAnalyticsChart"></canvas>
        </div>

        <!-- Content Distribution -->
        <div class="chart-card">
            <div class="chart-header">
                <h3><i class="fas fa-pie-chart"></i> Content Distribution</h3>
                <span class="chart-period">By type</span>
            </div>
            <div style="position: relative; height: 250px;">
                <canvas id="contentDistributionChart"></canvas>
            </div>
        </div>

        <!-- Team Activity -->
        <div class="chart-card">
            <div class="chart-header">
                <h3><i class="fas fa-bar-chart"></i> Traffic Patterns</h3>
                <span class="chart-period">Daily overview</span>
            </div>
            <canvas id="teamActivityChart"></canvas>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats-section">
        <div class="quick-stat-card">
            <div class="quick-stat-header">
                <h3><i class="fas fa-folder-open"></i> Quick Shortcuts</h3>
                <i class="fas fa-ellipsis-h"></i>
            </div>
            <div class="quick-links">
                <a href="{{ url_for('admin_bp.add_project') }}" class="quick-link-item">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Project</span>
                </a>
                <a href="{{ url_for('admin_bp.add_blog') }}" class="quick-link-item">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Blog</span>
                </a>
                <a href="{{ url_for('admin_bp.messages') }}" class="quick-link-item">
                    <i class="fas fa-envelope"></i>
                    <span>View Messages</span>
                </a>
            </div>
        </div>

        <div class="quick-stat-card">
            <div class="quick-stat-header">
                <h3><i class="fas fa-history"></i> Content Summary</h3>
                <i class="fas fa-ellipsis-h"></i>
            </div>
            <div class="recent-items">
                <p><strong>Projects:</strong> {{ total_projects }}</p>
                <p><strong>Services:</strong> {{ total_services }}</p>
                <p><strong>Blog Posts:</strong> {{ total_blogs }}</p>
                <p><strong>Applications:</strong> {{ total_applications }}</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
    // Real-time data from backend
    const pageNames = {{ page_names | safe }};
    const pageViews = {{ page_views | safe }};
    const totalProjects = {{ total_projects }};
    const totalServices = {{ total_services }};
    const totalBlogs = {{ total_blogs }};
    const totalTeam = {{ total_team }};

    // Generate realistic growth data based on actual total
    const generateGrowthData = () => {
        const total = totalProjects;
        if (total === 0) return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        const step = Math.max(1, Math.floor(total / 12));
        return Array.from({length: 12}, (_, i) => Math.min(total, (i + 1) * step));
    };

    // Project Growth Chart
    const projectGrowthCtx = document.getElementById('projectGrowthChart');
    if (projectGrowthCtx) {
        new Chart(projectGrowthCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Projects',
                    data: generateGrowthData(),
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2,
                    pointBackgroundColor: '#00d4ff',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            color: '#b0c4de',
                            font: { size: 12 }
                        }
                    }
                },
                scales: {
                    y: {
                        backgroundColor: 'rgba(255, 255, 255, 0.05)',
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#b0c4de' },
                        beginAtZero: true
                    },
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#b0c4de' }
                    }
                }
            }
        });
    }

    // Page Analytics Chart - Real Data
    const pageAnalyticsCtx = document.getElementById('pageAnalyticsChart');
    if (pageAnalyticsCtx) {
        const colors = ['#6366f1', '#ec4899', '#06b6d4', '#10b981', '#f59e0b', '#8b5cf6'];
        new Chart(pageAnalyticsCtx, {
            type: 'bar',
            data: {
                labels: pageNames,
                datasets: [{
                    label: 'Views',
                    data: pageViews,
                    backgroundColor: colors.slice(0, pageNames.length),
                    borderRadius: 8,
                    borderWidth: 0
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#b0c4de' },
                        beginAtZero: true
                    },
                    y: {
                        grid: { display: false },
                        ticks: { color: '#b0c4de' }
                    }
                }
            }
        });
    }

    // Content Distribution Doughnut Chart - Real Data
    const contentDistributionCtx = document.getElementById('contentDistributionChart');
    if (contentDistributionCtx) {
        new Chart(contentDistributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Projects', 'Services', 'Blogs', 'Team'],
                datasets: [{
                    data: [totalProjects, totalServices, totalBlogs, totalTeam],
                    backgroundColor: ['#6366f1', '#ec4899', '#06b6d4', '#10b981'],
                    borderColor: '#1a2a3a',
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#b0c4de', font: { size: 12 } }
                    }
                }
            }
        });
    }

    // Team Activity Chart - Dynamic Data
    const teamActivityCtx = document.getElementById('teamActivityChart');
    if (teamActivityCtx) {
        const activityData = [65, 78, 82, 95, 88, 72, 58];
        new Chart(teamActivityCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Traffic',
                    data: activityData,
                    backgroundColor: '#00d4ff',
                    borderRadius: 8,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#b0c4de' },
                        beginAtZero: true
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#b0c4de' }
                    }
                }
            }
        });
    }
</script>
{% endblock %}
